; PlatformIO Project Configuration File for Reaction Game Test
;
; Three environments:
; - display_test: ESP32-S3 with LVGL display
; - host_test: ESP32 DevKit-C with audio + NeoPixels
; - joystick_test: ESP8266 with button

; =============================================================================
; COMMON ENVIRONMENT SETTINGS
; =============================================================================
[env]
upload_speed = 921600

; =============================================================================
; DISPLAY TEST (ESP32-S3 Touch LCD 7")
; =============================================================================
[env:display_test]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; 8MB Flash + 8MB PSRAM
board_build.flash_mode = qio
board_build.arduino.memory_type = qio_opi
board_upload.flash_size = 8MB

; Build flags
build_flags = 
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DLV_CONF_INCLUDE_SIMPLE
    -I include
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue

; Libraries
lib_deps =
    lovyan03/LovyanGFX@^1.1.16
    lvgl/lvgl@^8.3.11

; Library dependency mode
lib_ldf_mode = deep+
lib_archive = false

; Build source filter - only compile display_test.cpp for this environment
build_src_filter = +<*> -<host_test.cpp> -<joystick_test.cpp>

; Monitor
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Filesystem (for images only)
board_build.filesystem = littlefs
extra_scripts = pre:scripts/copy_data.py


; =============================================================================
; HOST TEST (ESP32 DevKit-C / ZY-ESP32)
; =============================================================================
[env:host_test]
platform = espressif32
board = esp32dev
framework = arduino

; 4MB Flash
board_build.flash_mode = dio
board_upload.flash_size = 4MB

; Build flags
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -I include

; Libraries
lib_deps =
    adafruit/Adafruit NeoPixel@^1.12.3
    earlephilhower/ESP8266Audio@^1.9.7

; Build source filter - only compile host_test.cpp for this environment
build_src_filter = +<*> -<display_test.cpp> -<joystick_test.cpp>

; Monitor
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Filesystem (for audio files only)
board_build.filesystem = spiffs
board_build.partitions = default.csv
extra_scripts = pre:scripts/copy_data.py


; =============================================================================
; JOYSTICK TEST (ESP8266 ESP-12F)
; =============================================================================
[env:joystick_test]
platform = espressif8266
board = esp12e
framework = arduino

; 4MB Flash
board_build.flash_mode = dio
board_build.ldscript = eagle.flash.4m1m.ld

; Build flags
build_flags = 
    -DVTABLES_IN_FLASH
    -I include
    -DMY_ID=ID_STICK1  ; Change to ID_STICK2 for second joystick

; Libraries (minimal for ESP8266)
lib_deps =
    ; ESP8266 built-in ESP-NOW

; Build source filter - only compile joystick_test.cpp for this environment
build_src_filter = +<*> -<host_test.cpp> -<display_test.cpp>

; Monitor
monitor_speed = 115200


; =============================================================================
; JOYSTICK 2 TEST (ESP8266 ESP-12F)
; =============================================================================
[env:joystick2_test]
platform = espressif8266
board = esp12e
framework = arduino

; 4MB Flash
board_build.flash_mode = dio
board_build.ldscript = eagle.flash.4m1m.ld

; Build flags
build_flags = 
    -DVTABLES_IN_FLASH
    -I include
    -DMY_ID=ID_STICK2

; Libraries (minimal for ESP8266)
lib_deps =
    ; ESP8266 built-in ESP-NOW

; Build source filter - only compile joystick_test.cpp for this environment
build_src_filter = +<*> -<host_test.cpp> -<display_test.cpp>

; Monitor
monitor_speed = 115200


; =============================================================================
; GLOBAL SETTINGS
; =============================================================================
[platformio]
; Uncomment to set default environment
; default_envs = host_test

; Project structure
src_dir = src
include_dir = include
lib_dir = lib
data_dir = data  ; Auto-populated by copy_data.py script

; Extra build flags for all environments
; (add common header paths here if needed)
